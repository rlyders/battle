REM $INCLUDE: 'HEADER.BAA'

'@@@@ MOVE PLAYER UP @@@@

SUB INITIAL.BUBBLE STATIC
 SHARED X1,Y1,T,YINC,XINC,LX,LY,X,Y,Y(),X(),V(),A(),P(),B1(),B2(),YPB,S
 '<Use>-X(),V(),A(),P(),CPLAYER,LPLAYER,B1,B2
 '<Define>-X1-Initial X,Y1-Initial Y,T-Initial Time,_
 'Yinc-Bubble Y Increment,XINC-Bubble X Increment,LX-Last X,LY-Last Y,_
 'X-Bubble X Pos,Y-Bubble Y Pos
 X1=X(CPLAYER)+V(CPLAYER)*9*COS(A(CPLAYER)*22/7/180)
 Y1=Y(CPLAYER)+V(LPLAYER)*7.5*SIN(A(CPLAYER)*22/7/180)
 YPB=0:T=.1-.5/(P(CPLAYER)*200)
 YINC=P(CPLAYER)*SIN((180*(CPLAYER-1)+A(CPLAYER))*22/7/180)
 XINC=P(CPLAYER)*COS((180*(CPLAYER-1)+A(CPLAYER))*22/7/180)
 S=0:S=S+T:X=X1+XINC*S:Y=-(YINC*S-4.9*S^2-Y1)
 LX=X:LY=Y

IF CPLAYER=1 THEN
  PUT(X,Y),B1
 ELSE
  PUT(X,Y),B2
 END IF
END SUB

SUB FIRE.BUBBLE.MOVEMENT STATIC
 SHARED S,T,X,X1,XINC,Y,Y1,YINC,PB,YPB,L(),X(),Y(),B1(),B2(),LX,LY
 '<Use>-S,T,X,X1,XINC,Y,Y1,YINC,PB,L(),LPLAYER,X(),Y(),CPLAYER,B1,B2,LX,LY
2110 S=S+T:X=X1+XINC*S:Y=-(YINC*S-4.9*S^2-Y1)
 POINTS=0
 IF Y<PB THEN IF YPB=0 THEN YPB=1:CALL ERASE.BUBBLE:GOTO 2110 ELSE 2110
 IF X<1+7 OR X>319-7 THEN
    IF YPB=0 THEN CALL ERASE.BUBBLE
    EXIT SUB
 ELSEIF Y>L(X)-7 OR Y>199-7 THEN
    CALL ERASE.BUBBLE
    CALL DESTROY.LAND
    CALL PLOT.SHOT(X)
    EXIT SUB
 END IF
 IF X>X(LPLAYER)-9 AND X<X(LPLAYER)+9 AND Y>Y(LPLAYER)-7 AND Y<Y(LPLAYER)+7 THEN
    CALL ERASE.BUBBLE
    CALL PLOT.SHOT(X)
    CALL ADD.POINTS(POINTS)
    EXIT SUB
 END IF
 IF YPB=0 THEN IF CPLAYER=1 THEN PUT(LX,LY),B1 ELSE PUT(LX,LY),B2
 IF CPLAYER=1 THEN PUT(X,Y),B1 ELSE PUT(X,Y),B2
 YPB=0:LX=X:LY=Y:GOTO 2110
END SUB

SUB ERASE.BUBBLE STATIC
 SHARED CPLAYER,LX,LY,B1(),B2()
 '<Use>-CPLAYER,LX,LY,B1,B2
 IF CPLAYER=1 THEN PUT(LX,LY),B1 ELSE PUT(LX,LY),B2
END SUB

SUB ADD.POINTS(POINTS) STATIC
 SHARED SCORE()
 BEEP:SCORE(CPLAYER)=SCORE(CPLAYER)+POINTS
END SUB

SUB Destroy.Land STATIC
 SHARED X,Y,LX,LY,L(),LC,SBY
 STATIC XX,YY,LLXX,BEGX,ENDX
 '<Use>-X
 '<Loops>-XX-Land X Pos
2290 BEGX=X-ABS(((X-LX)*(Y-LY))/(RND*2+2))
 ENDX=X+ABS(((X-LX)*(Y-LY))/(RND*2+2))
 IF BEGX<1 THEN BEGX=1
 IF ENDX>319 THEN ENDX=319
 LLXX=L(BEGX-1)
 FOR XX=BEGX TO ENDX STEP (ABS(ENDX>BEGX)*2-1)
 IF ABS(Y-L(XX))>10 THEN LLXX=L(XX):GOTO 2320
 YY=L(XX)+ABS(((ABS(X-LX)+20)/(ABS(X-XX)/10+1))*((ABS(Y-LY)+20)/_
    (ABS(Y-L(XX)/10+1))))
 'YY=Y+ABS(((X-LX)*(Y-LY))/((X-XX)*(Y-L(XX))*(RND*2+1)*7))
 IF YY>=SBY-1 THEN YY=SBY-2
 LINE(XX,L(XX)-1)-(XX,YY),0
 LINE(XX,L(XX))-(XX-1,LLXX),0
 LLXX=L(XX):L(XX)=YY
 LINE(XX,L(XX))-(XX-1,L(XX-1)),LC
2320 NEXT XX
 LINE(XX,L(XX))-(XX-1,LLXX),0
 LINE(XX,L(XX))-(XX-1,L(XX-1)),LC
END SUB

SUB fire.images STATIC
 RANDOMIZE TIMER
 FC=0:LFX=1:LFY=1:FOR FX=1 TO 9
 IF FC=4 THEN FC=14 ELSE FC=4
 FY=LFY+RND*5-2
 LINE(LFX,LFY)-(FX,FY),FC
 LFX=FX:LFY=FY:NEXT FX
 FOR FX=11 TO 20
 FY=LFY-RND*5-2
 LINE(LFX,LFY)-(FX,FY),FC
 LFX=FX:LFY=FY:NEXT FX
END SUB

SUB PLOT.SHOT(SHOTX) STATIC
    SHARED SHOTX(),C(),SBY,SBB,SBO
    STATIC SHOT
    IF SHOTX<>SHOTX(CPLAYER,0) THEN
       FOR SHOT=8 TO 1 STEP -1
       SHOTX(CPLAYER,SHOT)=SHOTX(CPLAYER,SHOT-1)
       IF SHOTX(CPLAYER,SHOT)>0 AND SHOTX(CPLAYER,SHOT)<>SHOTX(LPLAYER,0) THEN
	  LINE(SHOTX(CPLAYER,SHOT),SBY+1)-(SHOTX(CPLAYER,SHOT),SBY+SHOT),SBB
       END IF
       NEXT SHOT
    END IF
    SHOTX(CPLAYER,0)=SHOTX
    LINE(SHOTX(CPLAYER,0),SBY+1)-(SHOTX(CPLAYER,0),SBY+8),C(CPLAYER)
END SUB
