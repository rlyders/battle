DIM L(320),P1(38),P2(38),B1(4),B2(4),V(2),C(2),PL(2),PR(2),A(2),P(2),X(2)
DIM Y(2),SCORE(11),SHOTX(2,10),LOAN(2,5,4),CLOAN(2),SQ(2),TECHNIQUE(4,5)
DIM CTECHNIQUE(2),W(2),RESOURCE(4),SCOST(2)
'COMMON CPLAYER,LPLAYER,LC,PC,MC,SBY,SBO,SBB,AC,V(),C(),PT,PB,P(),PL(),L()
'COMMON PR(),X(),Y(),A(),B1(),B2(),P1(),P2(),SCORE(),SHOTX(),POINTS,LX,LY
'COMMON X1,Y1,T,YINC,XINC,X,Y,YPB,S,HOVER,RED,GREEN,BLACK,BROWN,SO,PBB
'COMMON PBL,PBC
'REM $INCLUDE: 'HEADER.BAS'

'CPLAYER-CURRENT PLAYER
 '@@@@ Set Opening Variables @@@@
 '<Define>-L(0-319)-Land Y's,P1(0-37)-Player one's ship,
 'P2(0-37)-Player two's ship,B1(0-3)-Player one's bubble,
 'B2(0-3)-Player two's bubble
 '<Define>-CPLAYER-Player,LC-Land/Peak Color,MC-Mountain Color,AC-Angle Color,
 'V(1-2)-Special Player Values,C(1-2)-Player Colors,PT-Power Box Top,
 'PB-Power Box Bottom,PL(1-2)-Player's Power Left,
 'PR(1-2)-Player's Power Right,A(1-2)-Player Angles,LPLAYER-Last Player
 'SBY-SHOT BOX'S TOP,SBB-SHOT BOX'S BACKGROUND COLOR,
 'SBO-SHOT BOX'S OUTLINE COLOR

 '@@@@@@@@@@@@@@@@@@@@@@
 '@@@@ BATTLE 'Main'@@@@
 '@@@@@@@@@@@@@@@@@@@@@@

 CONST SBY=190, BLACK=0, GREEN=1, RED=2, BROWN=3, MXLOAN=5, PT=2, PB=PT+5
 CONST LC=BROWN, MC=RED, SBO=BROWN, SBB=BLACK, AC=BROWN
 CONST PBB=RED, PBL=BLACK, PBC=BROWN, SO=BROWN, PI=3.141592654

 SCREEN 1,1

 KEY OFF
 COLOR ,BLACK
 'PALETTE 0,4
 'PALETTE 1,8
 'PALETTE 2,6
 'PALETTE 3,1

Initialization:
 CPLAYER=2
 V(1)=1
 V(2)=-1
 C(1)=RED
 C(2)=GREEN
 HOVER=0
 FOR L=1 TO 2
  P(L)=30
  PL(L)=10+150*(L-1)
  PR(L)=PL(L)+100
 NEXT L
 A(1)=45
 A(2)=-45
 CLS
 CLOAN(1)=1
 CLOAN(2)=1
 W(1)=1500
 W(2)=1500
 RANDOMIZE TIMER

 CALL SET.TECHNIQUES
 CALL CHOOSE.PLAYER.SITE
 CALL CREATE.LAND
 CALL CREATE.IMAGES
 CALL DRAW.LAND
 CALL DRAW.SCREEN

MAIN.LOOP:
 CALL SWITCH.PLAYERS
 CALL USER.INPUT(CUE)
 IF CUE=1 THEN GOTO INITIALIZATION
 CALL INITIAL.BUBBLE
 CALL FIRE.BUBBLE.MOVEMENT
 GOTO MAIN.LOOP

'@@@@ MOVE PLAYER UP @@@@

SUB INITIAL.BUBBLE STATIC
 SHARED X1,Y1,T,YINC,XINC,LX,LY,X,Y,Y(),X(),V(),A(),P(),B1(),B2(),YPB,S
 SHARED CPLAYER,LPLAYER,SQ()
 '<Use>-X(),V(),A(),P(),CPLAYER,LPLAYER,B1,B2
 '<Define>-X1-Initial X,Y1-Initial Y,T-Initial Time,_
 'Yinc-Bubble Y Increment,XINC-Bubble X Increment,LX-Last X,LY-Last Y,_
 'X-Bubble X Pos,Y-Bubble Y Pos
 TIMESTEP=.01
 ANG=A(CPLAYER)+RND*SQ(CPLAYER)
 POW=P(CPLAYER)+RND*SQ(CPLAYER)
 X1=X(CPLAYER)+V(CPLAYER)*9*COS(ANG*PI/180)
 Y1=Y(CPLAYER)+V(LPLAYER)*7.5*SIN(ANG*PI/180)
 YPB=0
 T=TIMESTEP-TIMESTEP/(POW*400)
 YINC=POW*SIN((180*(CPLAYER-1)+ANG)*PI/180)
 XINC=POW*COS((180*(CPLAYER-1)+ANG)*PI/180)
 S=0
 S=S+T
 X=X1+XINC*S
 Y=-(YINC*S-4.9*S^2-Y1)
 LX=X
 LY=Y
 IF CPLAYER=1 THEN
  PUT(X,Y),B1
 ELSE
  PUT(X,Y),B2
 END IF
END SUB

SUB SHOW.FORMULA STATIC
 LOCATE 20,1
 PRINT "x=(vCOS @)t      y=(-1/2)gt^2+(vSIN @)t"
 PRINT "x=("POW"COS "ANG")t      y=(-1/2)"9.81"t^2+("POW"SIN "ANG")t"
END SUB
 'X=(X(CPLAYER)+V(CPLAYER)*9*COS((A(CPLAYER)+RND*SQ(CPLAYER))*PI/180))+((P(CPLAYER)+RND*SQ(CPLAYER))*COS((180*(CPLAYER-1)+(A(CPLAYER)+RND*SQ(CPLAYER)))*PI/180))*S
 'Y=-(((P(CPLAYER)+RND*SQ(CPLAYER))*SIN((180*(CPLAYER-1)+(A(CPLAYER)+RND*SQ(CPLAYER)))*PI/180))*S-4.9*S^2-(Y(CPLAYER)+V(LPLAYER)*7.5*SIN((A(CPLAYER)+RND*SQ(CPLAYER))*PI/180)))

SUB FIRE.BUBBLE.MOVEMENT STATIC
 SHARED S,T,X,X1,XINC,Y,Y1,YINC,YPB,L(),X(),Y(),B1(),B2(),LX,LY,CPLAYER
 SHARED LPLAYER
 '<Use>-S,T,X,X1,XINC,Y,Y1,YINC,PB,L(),LPLAYER,X(),Y(),CPLAYER,B1,B2,LX,LY
2110
 S=S+T
 X=((POW/10)*COS ANG)*S
 Y=(-1/2)*9.81*S^2+((POW/10)SIN ANG)*S
 POINTS=0
 IF Y<PB THEN
  IF YPB=0 THEN
   YPB=1
   CALL ERASE.BUBBLE
   GOTO 2110
  ELSE
   GOTO 2110
  END IF
 END IF
 IF X<1+7 OR X>319-7 THEN
    IF YPB=0 THEN
     CALL ERASE.BUBBLE
    END IF
    EXIT SUB
 ELSEIF Y>L(X)-7 OR Y>199-7 THEN
    CALL ERASE.BUBBLE
    CALL DESTROY.LAND
    CALL PLOT.SHOT(X)
    EXIT SUB
 END IF
 IF X>X(LPLAYER)-9 AND X<X(LPLAYER)+9 AND Y>Y(LPLAYER)-7 AND Y<Y(LPLAYER)+7 THEN
    CALL ERASE.BUBBLE
    CALL PLOT.SHOT(X)
    CALL ADD.POINTS(POINTS)
    EXIT SUB
 END IF
 IF YPB=0 THEN
  IF CPLAYER=1 THEN
   PUT(LX,LY),B1
  ELSE
   PUT(LX,LY),B2
  END IF
 END IF
 IF CPLAYER=1 THEN
  PUT(X,Y),B1
 ELSE
  PUT(X,Y),B2
 END IF
 YPB=0
 LX=X
 LY=Y
 GOTO 2110
END SUB

SUB ADD.POINTS(POINTS) STATIC
 SHARED SCORE()
 BEEP
 SCORE(CPLAYER)=SCORE(CPLAYER)+POINTS
END SUB

SUB OPTIONS STATIC
 SHARED CLOAN(),CPLAYER,X(),Y(),P1(),P2()
 CLS
 OP=0
 WHILE NOT OP=4
  PRINT "1> SHIP QUALITY"
  PRINT "2> LOAN"
  PRINT "3> MANUFACTURING TECHNIQUE"
  PRINT "4> EXIT MENU"
  INPUT "OPTION #:";OP
  IF OP=1 THEN
   CALL SHIP.QUALITY
  ELSEIF OP=2 AND CLOAN(CPLAYER)<MXLOAN THEN
   CALL GET.LOAN
  ELSEIF OP=3 THEN
   CALL TECHNIQUE
  END IF
 WEND
 CLS
 CALL DRAW.LAND
 PUT(X(CPLAYER)-9,Y(CPLAYER)-7),P1
 PUT(X(CPLAYER)-9,Y(CPLAYER)-7),P2
 CALL DRAW.SCREEN
END SUB

SUB GET.LOAN STATIC
 SHARED CPLAYER,LOAN(),CLOAN(),INTEREST%,INSTALLMENT%,PERIODS%,LOAN%
 'LOAN(PLAYER,#,<LOAN(0),INTEREST(1),PERIODS(2),INSTALLMENT(3)>)
 CLS
 INPUT "AMOUNT OF LOAN:";LOAN
 INTEREST=20-15*RND
 PERIODS=INTEREST/2
 INSTALLMENT=INT((LOAN+INTEREST*LOAN/100)/PERIODS)
 PRINT USING"LOAN: $$######.##,  AT ##.##% INTEREST";LOAN,INTEREST
 PRINT USING"IN ## INSTALLMENTS OF $$######.##,";PERIODS,INSTALLMENT
 LOAN(CPLAYER,CLOAN(CPLAYER),LOAN%)=LOAN
 LOAN(CPLAYER,CLOAN(CPLAYER),INTEREST%)=INTEREST
 LOAN(CPLAYER,CLOAN(CPLAYER),PERIODS%)=PERIODS
 LOAN(CPLAYER,CLOAN(CPLAYER),INSTALLMENTS%)=INSTALLMENTS
 W(CPLAYER)=W(CPLAYER)+LOAN
 CALL PAUSE
 CLS
END SUB

SUB SHIP.QUALITY STATIC
 SHARED SQ(),CPLAYER,SCOST()
 CLS
 INPUT "SHIP QUALITY:(1,BEST-5,WORST)";SQ(CPLAYER)
 PRINT "SHIP QUALITY="SQ(CPLAYER);
 PRINT USING ",  PRICE=$$#####.##,";SCOST(CPLAYER)/SQ(CPLAYER)
 CALL PAUSE
 CLS
END SUB

SUB TECHNIQUE STATIC
 SHARED TECHNIQUE(),CTECHNIQUE(),CPLAYER,SCOST(),SQ()
 'TECHNIQUE(#,RESOURCE.PRICE)
 CLS
 LOCATE 5:PRINT "RESOURCE"
 LOCATE 6:PRINT "LABOR"
 LOCATE 7:PRINT "LAND"
 LOCATE 8:PRINT "CAPITAL"
 LOCATE 9:PRINT "ENTREPRE-"
 LOCATE 10:PRINT "NEURIAL"
 LOCATE 11:PRINT "ABILITY"
 FOR TECH=0 TO 3
  LOCATE 5,10+TECH*7
  PRINT USING "TQ_##";TECH+1
  FOR RESOURCE=0 TO 3
   LOCATE 5+RESOURCE+1,10+TECH*7
   PRINT TECHNIQUE(TECH,RESOURCE)
  NEXT RESOURCE
 NEXT TECH
 FOR A=0 TO 3
  LOCATE 13+A
  PRINT USING "TECH _## -> $$#####,.##";A,TECHNIQUE(A,4)
 NEXT A
 LOCATE 20
 INPUT "ENTER DESIRED TECHNIQUE #:";CTECHNIQUE(CPLAYER)
 CTECHNIQUE(CPLAYER)=CTECHNIQUE(CPLAYER)-1
 SCOST(CPLAYER)=TECHNIQUE(CTECHNIQUE(CPLAYER),4)/SQ(CPLAYER)
 PRINT USING "SHIP PRICE:$$#####,.##";SCOST(CPLAYER)
 CALL PAUSE
 CLS
END SUB

SUB SHOW.WEALTH STATIC
 SHARED CPLAYER,W()
 EXIT SUB
 FOR A=1 TO 2
  LOCATE 23,1+(A-1)*25
  PRINT USING "$$#######.##,";W(CPLAYER);
 NEXT A
END SUB

SUB SET.TECHNIQUES STATIC
 SHARED TECHNIQUE(),RESOURCE()
 FOR A=0 TO 3
  RESOURCE(A)=500*RND
 NEXT A
 SUM=0
 FOR A=0 TO 3
  FOR B=0 TO 3
   TECHNIQUE(A,B)=INT(1+RND*15)
   SUM=SUM+RESOURCE(B)*TECHNIQUE(A,B)
  NEXT B
  TECHNIQUE(A,B)=SUM
 NEXT A
END SUB
